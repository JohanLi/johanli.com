---
- hosts: webserver

  tasks:

  - name: deploy master branch
    git:
      repo: https://github.com/JohanLi/johanli.com.git
      dest: /var/www/{{ domain }}
      force: yes

  - name: deploy static files
    synchronize:
      src: ../../build/
      dest: /var/www/{{ domain }}/build/

  - name: start application
    command: "{{ item }} chdir=/var/www/{{ domain }}"
    loop:
      - npm install --production
      - npm run prod:start
