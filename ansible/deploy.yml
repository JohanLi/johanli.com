---
- hosts: webservers

  tasks:

  - name: deploy master branch
    git: repo=https://github.com/JohanLi/johanli.com.git dest=/var/www/{{ domain }}

  - name: deploy static files
    synchronize: src=../dist/ dest=/var/www/{{ domain }}/dist/

  - name: start application
    command: "{{ item }} chdir=/var/www/{{ domain }}"
    with_items:
    - npm install
    - npm run prod:start